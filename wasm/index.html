<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BinLing Monitor</title>
    <style>
        body {
            background-color: #0d1117;
            color: #c9d1d9;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        h1 {
            color: #58a6ff;
            margin-bottom: 10px;
        }

        #dashboard {
            border: 1px solid #30363d;
            background: #161b22;
            padding: 40px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            min-width: 300px;
        }

        .metric {
            font-size: 2em;
            font-weight: bold;
            color: #3fb950;
            margin: 20px 0;
        }

        .label {
            font-size: 0.8em;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #status-line {
            margin-top: 20px;
            color: #8b949e;
            font-size: 0.9em;
        }

        .blink {
            animation: blinker 1s linear infinite;
        }

        @keyframes blinker {
            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>

<body>

    <div id="dashboard">
        <h1>ðŸ“¡ BinLing Remote View</h1>

        <div class="label">Server Cycle</div>
        <div id="cycle-count" class="metric">--</div>

        <div class="label">Active Organisms</div>
        <div id="cell-count" class="metric">--</div>

        <div id="status-line">Connecting to Node...</div>
    </div>

    <script>
        const statusDiv = document.getElementById("status-line");
        const cycleDiv = document.getElementById("cycle-count");
        const cellDiv = document.getElementById("cell-count");

        function connect() {
            // Connect to our new CLI WebSocket Port
            const socket = new WebSocket("ws://localhost:8081");

            socket.onopen = () => {
                statusDiv.innerText = "LINK ESTABLISHED. LISTENING...";
                statusDiv.style.color = "#3fb950"; // Green
                statusDiv.classList.add("blink");
            };

            socket.onmessage = (event) => {
                // Server sends: "Cycle:100|Active:5"
                const data = event.data;
                const parts = data.split('|');

                if (parts.length >= 2) {
                    const cycle = parts[0].split(':')[1];
                    const active = parts[1].split(':')[2] || parts[1].split(':')[1]; // Handle variations

                    cycleDiv.innerText = cycle;
                    cellDiv.innerText = active;
                }
            };

            socket.onclose = () => {
                statusDiv.innerText = "CONNECTION LOST. RECONNECTING...";
                statusDiv.style.color = "#ff7b72"; // Red
                statusDiv.classList.remove("blink");
                setTimeout(connect, 3000); // Try again in 3 seconds
            };

            socket.onerror = (err) => {
                console.error("Socket error", err);
                socket.close();
            };
        }

        connect();
    </script>
</body>

</html>